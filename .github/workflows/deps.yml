on:
  workflow_call:
    inputs:
      linux-deps:
        type: string
      macos-deps:
        type: string
        default: ''
      os:
        type: string
      bits:
        type: string
      android:
        type: string
    outputs:
      os:
        value: ${{ inputs.os }}
      bits:
        value: ${{ inputs.bits }}
      android:
        value: ${{ inputs.android }}

jobs:
  deps-linux:
    strategy:
      matrix:
        os: [ubuntu-latest]
        bits: ['', '--64bits']
        android: ['']
        include:
          - os: ubuntu-20.04
            bits: ''
            android: '--android=armeabi-v7a-hard,4.9,21 --togles'

    runs-on: ${{ matrix.os }}
    env:
      DEPS: ${{ inputs.linux-deps }}
    steps:
      - uses: actions/checkout@v3
        with:
          submodules: recursive

      # Linux
      - name: Install common dependencies
        run: sudo apt-get update && sudo apt-get install -y g++-multilib gcc-multilib
      - name: Install 32bit linux dependencies
        if: ${{ !matrix.bits && !matrix.android }}
        run: |
          sudo dpkg --add-architecture i386
          sudo apt-get update
          sudo apt-get install -y aptitude
          sudo aptitude install -y $(echo $DEPS | sed -r 's/[a-z0-9_\-]+/&:i386/g')
          echo "PKG_CONFIG_PATH=/usr/lib/i386-linux-gnu/pkgconfig" >> $GITHUB_ENV
      - name: Install 64bit linux dependencies
        if: ${{ inputs.bits }}
        run: |
          sudo apt-get install -y $DEPS
      - name: Install Android SDK
        if: ${{ inputs.android }}
        run: |
          wget https://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip -o /dev/null
          unzip android-ndk-r10e-linux-x86_64.zip
          export NDK_HOME=$PWD/android-ndk-r10e/
          echo "NDK_HOME=$NDK_HOME" >> $GITHUB_ENV
          echo "ANDROID_NDK_HOME=$NDK_HOME" >> $GITHUB_ENV

